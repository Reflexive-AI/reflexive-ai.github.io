---
import Base from '@/layouts/Base.astro';
import ArticleCard from '@/components/ArticleCard.astro';
import { getCollection } from 'astro:content';

const allArticles = await getCollection('research');
const sortedArticles = allArticles
  .filter(a => !a.data.draft)
  .sort((a, b) => {
    // Sort by article number extracted from slug (e.g., "051-foo")
    const numA = parseInt(a.slug.split('-')[0], 10) || 0;
    const numB = parseInt(b.slug.split('-')[0], 10) || 0;
    return numB - numA; // Descending: newest first
  });
---

<Base title="Research" description="All research articles from the Reflexive AI Initiative">
  <div class="container" style="padding: var(--space-12) var(--space-6);">
    <header style="margin-bottom: var(--space-10);">
      <h1>Research</h1>
      <p class="text-secondary" style="font-size: 1.2rem; max-width: 60ch;">
        {sortedArticles.length} articles exploring AI governance, safety, and the role of 
        AI systems in their own regulation.
      </p>
    </header>
    
    <div class="article-grid">
      {sortedArticles.map((article, index) => {
  const num = parseInt(article.slug.split('-')[0], 10) || index + 1;
        return (
          <ArticleCard
            number={num}
            title={article.data.title}
            excerpt={article.data.excerpt}
            slug={article.slug}
            tags={article.data.tags}
          />
        );
      })}
    </div>
  </div>
</Base>
